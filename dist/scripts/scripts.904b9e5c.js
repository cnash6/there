"use strict";angular.module("thereApp",["ngAnimate","ngAria","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/people",{templateUrl:"views/people.html",controller:"PeopleCtrl",controllerAs:"peopleCtrl"}).when("/",{templateUrl:"views/appointments.html",controller:"AppointmentsCtrl",controllerAs:"appointmentsCtrl"}).when("/schedule",{templateUrl:"views/appointments.html",controller:"AppointmentsCtrl",controllerAs:"appointmentsCtrl"}).when("/review",{templateUrl:"views/review.html",controller:"ReviewCtrl",controllerAs:"reviewCtrl"}).when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl",controllerAs:"loginCtrl"}).when("/session",{templateUrl:"views/session.html",controller:"SessionCtrl",controllerAs:"sessionCtrl"}).when("/appointment/create",{templateUrl:"views/create-appointment.html",controller:"CreateAppointmentCtrl",controllerAs:"createAppointmentCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location",function(a,b){a.$on("$locationChangeStart",function(b,c,d){a.session&&(a.session.off(),a.session.disconnect(),a.session=null)})}]).constant("_",_).constant("moment",moment),angular.module("thereApp").controller("AppointmentsCtrl",["$scope","$location","moment","api","auth",function(a,b,c,d,e){function f(){var b=d.getRef("users");b.once("value",function(b){for(var c=b.val(),d=$.map(c,function(a,b){return[a]}),e=0;e<a.apps.length;e++)for(var f=0;f<d.length;f++)a.apps[e].client==d[f].username&&(a.apps[e].imageurl=d[f].imageurl,a.fullnames[d[f].username]=d[f].name);a.$apply()})}a.apps=d.getArray("appointments"),a.fullnames=[],a.apps.$ref().on("value",function(a){f()}),a.addAppointment=function(b,c){a.appointments.child(b).update(c)},a.addApp=function(){d.update("appointments",{therapist:"cnash",interpreter:"adaniel",client:"wriley",description:"This is a remote session",sessionid:"2_MX40NTU0ODgzMn5-MTQ1OTcwMjY2NzA1NX5FT2h1ZnZQendJMFNSZkdQWDcwQThZNmN-UH4",startdate:c().add(2,"days").valueOf()})},a.goToAppointment=function(a){b.path("/session").search({sessionid:a.sessionid})},a.getFullName=function(b){return a.fullnames[b]},a.myUpcomingAppointments=function(a,b,c){var d=e.getCurrentUser();return d&&(a.therapist===d.username||a.interpreter===d.username||a.client===d.username||a.observer===d.username)}}]),angular.module("thereApp").controller("MainCtrl",["$scope","$location",function(a,b){a.isActivePage=function(a){return b.path()===a}}]),angular.module("thereApp").controller("PeopleCtrl",function(){}),angular.module("thereApp").controller("SessionCtrl",["$scope","$rootScope","$location","$http","auth",function(a,b,c,d,e){function f(a,c,d){var e=OT.initSession(a,h);b.session=e,e.on({streamCreated:function(a){var b=a.stream.connection.data;"interpreter"==b?e.subscribe(a.stream,"theirCamDiv",{width:"100%",height:"100%"}):e.subscribe(a.stream,"mainCamDiv",{width:"100%",height:"100%",insertMode:"replace"})}}),e.connect(d,function(a){a?console.log(a.message):e.publish("myCamDiv",{width:"100%",height:"100%"})})}var g="45548832",h="2_MX40NTU0ODgzMn5-MTQ1OTYwNDg0NDg0N35EU3U1cktYY2lhTEJHc3VPQTNXNFY4NGR-UH4";c.search().sessionid&&(h=c.search().sessionid),e.setSessionId(h);var i=e.getCurrentUser();i?d({method:"GET",url:"https://refugeehackthere.herokuapp.com/gettoken",params:{sessionid:h,role:i.role}}).then(function(a){var b=a.data.token;f(g,h,b)},function(a){console.log(a.statusText);f(g,h)}):alert("Not Logged in! Log in to access session"),a.startArchive=function(){$(".glyphicon-record").length>0?($(".record-btn-icon").removeClass("glyphicon-record"),$(".record-btn-icon").addClass("glyphicon-stop")):($(".record-btn-icon").removeClass("glyphicon-stop"),$(".record-btn-icon").addClass("glyphicon-record"))}}]),angular.module("thereApp").controller("CreateAppointmentCtrl",["$scope","moment","api",function(a,b,c){a.selected=void 0,a.userref=c.getArray("users"),console.log(a.userref),a.userref.$ref().on("value",function(b){a.userObj=b.val(),a.userArr=$.map(a.userObj,function(a,b){return[a]}),a.users=[];for(var c=0;c<a.userArr.length;c++)a.users.push(a.userArr[c].name);console.log(a.users),a.$apply()}),a.test=["Christian Nash","Will Riley","Anthony Daniel","Anthony Daniel","Christian Nash","Will Riley","Anthony Daniel","Christian Nash","Will Riley","Anthony Daniel","Christian Nash","Will Riley"]}]),angular.module("thereApp").controller("LoginCtrl",["$scope","auth",function(a,b){a.login=b.login}]),angular.module("thereApp").controller("ReviewCtrl",["$scope","$location","moment","api","auth",function(a,b,c,d,e){function f(){var b=d.getRef("users");b.once("value",function(b){var c=b.val(),d=$.map(c,function(a,b){return[a]});console.log(d);for(var e=0;e<a.apps.length;e++)for(var f=0;f<d.length;f++)a.apps[e].client==d[f].username&&(a.apps[e].imageurl=d[f].imageurl,a.fullnames[d[f].username]=d[f].name);a.$apply()})}a.fullnames=[],a.apps=d.getArray("appointments"),a.apps.$ref().on("value",function(a){f()}),a.addAppointment=function(b,c){a.appointments.child(b).update(c)},a.addApp=function(){d.update("appointments",{therapist:"wriley",interpreter:"cnash",client:"adaniels",description:"This is a remote session yeah",startdate:c().add(7,"days").valueOf()})},a.addUser=function(){d.update("users",{name:"Anthony Daniel",role:"client",imageurl:"https://s3.amazonaws.com/there4u/anthonyd_LThumb.jpg"},"adaniel")},a.goToAppointment=function(a){b.path("/session").search({sessionid:a.sessionid})},a.getFullName=function(b){return a.fullnames[b]},a.myPastAppointments=function(a,b,c){var d=e.getCurrentUser();return d&&(a.therapist===d.username||a.interpretter===d.username||a.client===d.username||a.observer===d.username)}}]),angular.module("thereApp").service("api",["$firebaseArray","$q",function(a,b){function c(a){var b=new Firebase(i+a);return b}function d(b){var d=c(b);return a(d)}function e(a,d){var e=b.defer(),f=c(a);return d?f.child(d).once("value",function(a){var b=a.val();e.resolve(b)}):f.once("value",function(a){var b=a.val();e.resolve(b)}),e.promise}function f(a,d){var e=b.defer(),f=c(a);return d?f.child(d).once("value",function(a){e.resolve(a.exists())}):f.once("value",function(a){e.resolve(a.exists())}),e.promise}function g(a,d,e){var f=b.defer(),g=c(a);return e?g.child(e).update(d,function(a){a?f.reject(a):f.resolve()}):g.push().set(d,function(a){a?f.reject(a):f.resolve()}),f.promise}function h(a,b){var d=c(a);d.child(b).remove()}var i="https://there4you.firebaseio.com/";return{getRef:c,getArray:d,getValue:e,update:g,remove:h,exists:f}}]),angular.module("thereApp").service("auth",["api","$location","$cookies","$rootScope",function(a,b,c,d){function e(c,d){a.exists("users",c).then(function(d){d?a.getValue("users",c).then(function(a){h(a),b.path("/appointments")}):a.update("users",{role:"therapist",username:c,name:"Joe Smith"},c).then(function(){a.getValue("users",c).then(function(a){h(a),b.path("/appointments")})})})}function f(){k=null,c.remove("currentUser"),d.$broadcast("changeCurrentUser",null)}function g(){return c.getObject("currentUser")}function h(a){c.putObject("currentUser",a),d.$broadcast("changeCurrentUser",a)}function i(){return l}function j(a){l=a}var k=null,l=null;return{login:e,logout:f,getCurrentUser:g,getSessionId:i,setSessionId:j}}]),angular.module("thereApp").filter("countdown",function(){return function(a){var b,c=moment.duration(moment(a)-moment());return b=0===c.days()?c.humanize():moment(a).format("MM/DD/YY, h:mm a")}}),angular.module("thereApp").directive("sessionNotes",function(){return{restrict:"EA",scope:{session:"=session"},templateUrl:"views/session-notes.html",controller:["$scope","api","moment","auth",function(a,b,c,d){a.notes=b.getArray("notes"),a.addNote=function(a){b.update("notes",{sender:d.getCurrentUser(),text:a,createdAt:c().valueOf(),session:d.getSessionId()})}}]}}),angular.module("thereApp").directive("sessionMessages",function(){return{restrict:"EA",scope:{session:"=session"},templateUrl:"views/session-messages.html",controller:["$scope","api","moment","auth","$firebaseArray",function(a,b,c,d,e){a.messages=b.getArray("messages");for(var f=0;f<a.messages.length;f++)console.log("test"),console.log(a.messages[f]);a.addMessage=function(a){var e=d.getCurrentUser();b.update("messages",{sender:e?e.name:"",text:a,createdAt:c().valueOf(),session:d.getSessionId()})}}]}}),angular.module("thereApp").directive("sessionUsers",function(){return{restrict:"EA",scope:{session:"=session"},templateUrl:"views/session-users.html",controller:["$scope","api","moment","auth",function(a,b,c,d){}]}}),angular.module("thereApp").directive("headerAccount",function(){return{restrict:"EA",scope:{},templateUrl:"views/header-account.html",controller:["$scope","api","moment","auth","$rootScope",function(a,b,c,d,e){e.$on("changeCurrentUser",function(){console.log("changeCurrentUser"),a.currentUser=d.getCurrentUser()}),a.loggy=function(){d.logout()}}]}}),angular.module("thereApp").run(["$templateCache",function(a){a.put("views/appointments.html",'<h2 style="margin-left:20px">Upcoming Appointments</h2> <div style="margin-top:20px; margin-left: 20px"> <a ng-href="#/appointment/create"><i class="fa fa-plus fa-3x"></i> Create Appointment</a></div> <!-- <button class="btn btn-primary"ng-click="addApp()">Add Appointment</button>\n<button class="btn btn-primary"ng-click="addUser()">Add User</button> --> <div class="appointments-list-container"> <div ng-repeat="app in apps | filter:myUpcomingAppointments | orderBy: \'-startdate\' " class="appointment" ng-click="goToAppointment(app)"> <div class="appointment-profile-pic" ng-style="{\'background-image\': \'url(\' + app.imageurl + \')\'}"> </div> <div class="appointment-content"> <div class="row"> <span class="appointment-client col-xs-6">{{ getFullName(app.client) || app.client }}</span> <span class="appointment-date col-xs-6">{{app.startdate | countdown}}</span> </div> <div class="row"> <span class="col-xs-12 appointment-details">{{app.description}}</span> </div> <div class="row"> <span class="col-xs-12 appointment-users"> <span ng-if="app.therapist">Therapist: {{ getFullName(app.therapist) || app.therapist }} </span> &nbsp;&nbsp; <span ng-if="app.interpreter">Interpreter: {{ getFullName(app.interpreter) || app.interpreter }}</span> </span> </div> </div> </div> </div>'),a.put("views/create-appointment.html",'<div class="create-apptmt-container"> <h3>Create A New Appointment</h3> <form> <div class="form-group"> <input name="client" id="client" type="text" placeholder="enter a user" ng-model="selected" typeahead="user for user in test | filter:$viewValue | limitTo:8" class="form-control"> </div> <div class="form-group"> <label for="exampleInputPassword1">Password</label> <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password"> </div> <button type="submit" class="btn btn-default">Submit</button> </form> </div>'),a.put("views/header-account.html",'<a ng-if="currentUser" ng-click="loggy()"><i class="fa fa-sign-out"></i> Logout</a> <!-- <span ng-if="currentUser" >{{ currentUser.name }}</span> --> <a ng-if="!currentUser" ng-href="#/login"><i class="fa fa-sign-in"></i> Login</a>'),a.put("views/people.html","<p>This is the people view.</p>"),a.put("views/review.html",'<!-- <button class="btn btn-primary"ng-click="addApp()">Add Appointment</button>\n<button class="btn btn-primary"ng-click="addUser()">Add User</button> --> <h2 style="margin-left:20px">Past Appointments</h2> <div class="appointments-list-container"> <div ng-repeat="app in apps | filter:myPastAppointments | orderBy: \'-startdate\' " class="appointment" ng-click="goToAppointment(app)"> <div class="appointment-profile-pic" ng-style="{\'background-image\': \'url(\' + app.imageurl + \')\'}"> </div> <div class="appointment-content"> <div class="row"> <span class="appointment-client col-xs-6">{{getFullName(app.client)}}</span> <span class="appointment-date col-xs-6">{{app.startdate | countdown}}</span> </div> <div class="row"> <span class="col-xs-12 appointment-details">{{app.description}}</span> </div> <div class="row"> <span class="col-xs-12 appointment-users"> <span ng-if="app.therapist">Therapist: {{getFullName(app.therapist)}} |</span> <span ng-if="app.interpreter">Interpreter: {{getFullName(app.interpreter)}}</span> </span> </div> </div> </div> </div>'),a.put("views/session-messages.html",'<h4 class="sidebar-heading">Messages</h4> <div ng-repeat="message in messages" class="message-group"> <div class="message message-sender">{{message.sender}}</div> <div class="message message-receive">{{message.text}}</div> <div class="timestamp">{{message.createdAt | date:\'medium\'}}</div> </div> <div class="form-group flex-form-group"> <input type="text" ng-model="message" class="form-control"> <a ng-click="addMessage(message)" class="btn btn-success">Send</a> </div>'),a.put("views/session-notes.html",'<h4 class="sidebar-heading">Notes</h4> <div ng-repeat="note in notes" class="notes-group"> <div class="note"></div> <div class="note">{{note.text}}</div> <div class="timestamp">{{note.createdAt | date:\'medium\'}}</div> </div> <div class="form-group flex-form-group"> <textarea ng-model="note" class="form-control"></textarea> <a class="btn btn-success" ng-click="addNote(note)">Add</a> </div>'),a.put("views/session-users.html",'<div ng-repeat="user in users"> <div>{{user.name}}</div> <div>{{note.role}}</div> </div>'),a.put("views/session.html",'<div class="flex-container y-full"> <div class="video-container"> <div class="record-btn" ng-click="startArchive()"> <span class="glyphicon glyphicon-record record-btn-icon" aria-hidden="true"></span> </div> <div class="mainCamDiv-container"> <div id="mainCamDiv"></div> </div> <div class="myCamDiv-container"> <div id="myCamDiv"></div> </div> <div class="theirCamDiv-container"> <div id="theirCamDiv"></div> </div> </div> <div class="utility-sidebar"> <div class="utility-sidebar__wrapper"> <!--       <ul class="nav sidebar-tabs" role="tablist">\n        <li role="presentation" class="active"><a href="#profile" aria-controls="chat" role="tab" data-toggle="tab">\n          <i class="fa fa-comment"></i></a>\n        </li>\n        <li role="presentation"><a href="#messages" aria-controls="notes" role="tab" data-toggle="tab">\n          <i class="fa fa-file-text-o"></i></a>\n        </li>\n        <li role="presentation"><a href="#settings" aria-controls="activeusers" role="tab" data-toggle="tab">\n          <i class="fa fa-users"></i></a>\n        </li>\n      </ul> --> <!-- Tab panes --> <!-- <div class="tab-content">\n        <div role="tabpanel" class="tab-pane" id="chat">\n        </div>\n        <div role="tabpanel" class="tab-pane" id="notes">...</div>\n        <div role="tabpanel" class="tab-pane" id="activeusers">...</div>\n      </div> --> <uib-tabset active="active" vertical="false" class="flex-height"> <uib-tab index="0" active="tab.active"> <uib-tab-heading> <i class="fa fa-comment"></i> </uib-tab-heading> <session-messages session="session"></session-messages> </uib-tab> <uib-tab index="1"> <uib-tab-heading> <i class="fa fa-file-text-o"></i> </uib-tab-heading> <session-notes session="session"></session-notes> </uib-tab> <uib-tab index="2"> <uib-tab-heading> <i class="fa fa-users"></i> </uib-tab-heading> <session-users session="session"></session-users> </uib-tab>  </uib-tabset> </div> </div> </div>')}]);