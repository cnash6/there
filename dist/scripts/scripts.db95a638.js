"use strict";angular.module("thereApp",["ngAnimate","ngAria","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","firebase"]).config(["$routeProvider",function(a){a.when("/people",{templateUrl:"views/people.html",controller:"PeopleCtrl",controllerAs:"people"}).when("/",{templateUrl:"views/appointments.html",controller:"AppointmentsCtrl",controllerAs:"appointments"}).when("/session",{templateUrl:"views/session.html",controller:"SessionCtrl",controllerAs:"session"}).when("/createApptmt",{templateUrl:"views/createapptmt.html",controller:"CreateapptmtCtrl",controllerAs:"createApptmt"}).otherwise({redirectTo:"/"})}]).run(["$rootScope","$location",function(a,b){a.$on("$locationChangeStart",function(b,c,d){a.session&&(a.session.off(),a.session.disconnect(),a.session=null)})}]).constant("_",_).constant("moment",moment),angular.module("thereApp").controller("AppointmentsCtrl",["$scope","$firebaseArray","$location","moment","api",function(a,b,c,d,e){function f(){var b=new Firebase("https://there4you.firebaseio.com/users");b.once("value",function(b){var c=b.val(),d=$.map(c,function(a,b){return[a]});console.log(d);for(var e=0;e<a.apps.length;e++)for(var f=0;f<d.length;f++)a.apps[e].client==d[f].userid&&(a.apps[e].imageurl=d[f].imageurl);a.$apply()})}a.appointments=e.getRef("appointments"),a.apps=b(a.appointments),a.apps.$loaded().then(function(){f()}),a.appointments.on("value",function(a){f()}),a.addAppointment=function(b,c){a.appointments.child(b).update(c)},a.addApp=function(){e.update("appointments",{therapist:"wriley",interpreter:"cnash",client:"adaniels",description:"This is a remote session",startdate:d().add(7,"days").valueOf()})},a.addUser=function(){e.update("users",{userid:"adaniel",name:"Anthony Daniel",role:"client",imageurl:"https://s3.amazonaws.com/there4u/anthonyd_LThumb.jpg"})},a.goToAppointment=function(a){c.path("/session").search({sessionid:a.sessionid})}}]),angular.module("thereApp").controller("MainCtrl",["$scope","$location",function(a,b){a.isActivePage=function(a){return b.path()===a}}]),angular.module("thereApp").controller("PeopleCtrl",function(){}),angular.module("thereApp").controller("SessionCtrl",["$scope","$rootScope","$location","$http",function(a,b,c,d){d({method:"GET",url:"/gettoken",port:5e3}).then(function(a){console.log(a)},function(a){console.log(a.statusText)}),console.log(c.search());var e="45548832",f="2_MX40NTU0ODgzMn5-MTQ1OTYwNDg0NDg0N35EU3U1cktYY2lhTEJHc3VPQTNXNFY4NGR-UH4";c.search().sessionid&&(f=c.search().sessionid);var g="T1==cGFydG5lcl9pZD00NTU0ODgzMiZzaWc9M2EzMzhhOWUxYWJjNDYzOTZhZmNkMTQ5YjY1N2U0MjQ4YjlkNzYyOTpyb2xlPXB1Ymxpc2hlciZzZXNzaW9uX2lkPTJfTVg0ME5UVTBPRGd6TW41LU1UUTFPVFl3TkRnME5EZzBOMzVFVTNVMWNrdFlZMmxoVEVKSGMzVlBRVE5YTkZZNE5HUi1VSDQmY3JlYXRlX3RpbWU9MTQ1OTYwNTUwNiZub25jZT0wLjI3NzgzNzkxODQ5MTY1ODImZXhwaXJlX3RpbWU9MTQ1OTY5MTkwNg==",h=OT.initSession(e,f);b.session=h,h.on({streamCreated:function(a){h.subscribe(a.stream,"theirCamDiv",{insertMode:"append"})}}),h.connect(g,function(a){a?console.log(a.message):h.publish("myCamDiv",{width:"100%",height:"600px",name:"client"})})}]),angular.module("thereApp").controller("CreateapptmtCtrl",["moment","api",function(a,b){}]),angular.module("thereApp").service("api",function(){function a(a){var b=new Firebase(d+a);return b}function b(b,c,d){var e=a(b);d?e.child(appId).update(c):e.push().set(c)}function c(b,c){var d=a(b);d.child(c).remove()}var d="https://there4you.firebaseio.com/";return{getRef:a,update:b,remove:c}}),angular.module("thereApp").service("auth",["api",function(a){function b(b,c){f=a.getRef("users").child(b)}function c(){f=null}function d(){return f}function e(){return g}var f=null,g=null;return{login:b,logout:c,getCurrentUser:d,getCurrentSession:e}}]),angular.module("thereApp").filter("countdown",function(){return function(a){var b,c=moment.duration(moment(a)-moment());return b=0===c.days()?c.humanize():moment(a).format("MM/DD/YY, h:mm a")}}),angular.module("thereApp").directive("sessionNotes",function(){return{restrict:"EA",scope:{session:"=session"},templateUrl:"scripts/directives/session-notes/session-notes.html",controller:["$scope","api","moment","auth",function(a,b,c,d){a.addNote=function(e){b.update("notes",{sender:d.getCurrentUser(),text:message,createdAt:c().valueOf(),session:a.session})}}]}}),angular.module("thereApp").directive("sessionMessages",function(){return{restrict:"EA",scope:{session:"=session"},templateUrl:"scripts/directives/session-messages/session-messages.html",controller:["$scope","api","moment","auth",function(a,b,c,d){a.addMessage=function(e){b.update("messages",{sender:d.getCurrentUser(),text:e,createdAt:c().valueOf(),session:a.session})}}]}}),angular.module("thereApp").directive("sessionUsers",function(){return{restrict:"EA",scope:{session:"=session"},templateUrl:"scripts/directives/session-users/session-users.html",controller:["$scope","api","moment","auth",function(a,b,c,d){}]}}),angular.module("thereApp").run(["$templateCache",function(a){a.put("views/appointments.html",'<!-- <button class="btn btn-primary"ng-click="addApp()">Add Appointment</button>\n<button class="btn btn-primary"ng-click="addUser()">Add User</button> --> <div class="appointments-list-container"> <div ng-repeat="app in apps | orderBy: \'-startdate\' " class="appointment" ng-click="goToAppointment(app)"> <div class="appointment-profile-pic" ng-style="{\'background-image\': \'url(\' + app.imageurl + \')\'}"> </div> <div class="appointment-content"> <div class="row"> <span class="appointment-client col-xs-6">{{app.client}}</span> <span class="appointment-date col-xs-6">{{app.startdate | countdown}}</span> </div> <div class="row"> <span class="col-xs-12 appointment-details">This is the description of this appointment</span> </div> <div class="row"> <span class="col-xs-12 appointment-users"> <span ng-if="app.therapist">Therapist: {{app.therapist}} |</span> <span ng-if="app.interpreter">Interpreter: {{app.interpreter}}</span> </span> </div> </div> </div> </div>'),a.put("views/createapptmt.html",'<div class="create-apptmt-container"> <h3>Create A New Appointment</h3> <form> <div class="form-group"> <label for="exampleInputEmail1">Email address</label> <input type="email" class="form-control" id="exampleInputEmail1" placeholder="Email"> </div> <div class="form-group"> <label for="exampleInputPassword1">Password</label> <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password"> </div> <button type="submit" class="btn btn-default">Submit</button> </form> </div>'),a.put("views/people.html","<p>This is the people view.</p>"),a.put("views/session.html",'<div class="flex-container y-full"> <div class="video-container"> <div id="myCamDiv"></div> <div id="theirCamDiv"></div> </div> <div class="utility-sidebar"> <div class="utility-sidebar__wrapper"> <ul class="nav sidebar-tabs" role="tablist"> <li role="presentation" class="active"><a href="#profile" aria-controls="chat" role="tab" data-toggle="tab"> <i class="fa fa-comment"></i></a> </li> <li role="presentation"><a href="#messages" aria-controls="notes" role="tab" data-toggle="tab"> <i class="fa fa-file-text-o"></i></a> </li> <li role="presentation"><a href="#settings" aria-controls="activeusers" role="tab" data-toggle="tab"> <i class="fa fa-users"></i></a> </li> </ul> <!-- Tab panes --> <div class="tab-content"> <div role="tabpanel" class="tab-pane" id="chat"> <session-messages session="session"></session-messages> </div> <div role="tabpanel" class="tab-pane" id="notes">...</div> <div role="tabpanel" class="tab-pane" id="activeusers">...</div> </div> </div> </div> </div>')}]);